<html>
  <head>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script src="./formToJSON.js"></script>
    <script src="./FileSaver.js"></script>

    <script>
      let data;
      function split(value) {
        let parts = value.split('_');
        document.getElementById('user').value = parts[0];
        document.getElementById('code').value = parts[1];
        document.getElementById('batch').value = parts.slice(2).join('_');
      }
      function changedForm(form) {
        data = formToJSON(form);
        createText(data);
        console.log(data);
      }
      function createText(data) {
        let experiment = `
USER ${data.user}
HOLDER ${data.holder}
DELETE
HOLDER ${data.holder}
#
NAME ${data.code}_${data.batch}
EXPNO 10
SOLVENT ${data.solvent}
PARAMETERS ns,1,td,1024
EXPERIMENT sw_cosy45
TITLE Code: ${data.code}\nBatch: ${data.batch}
NAME ${data.code}_${data.batch}
EXPERIMENT PROTON
TITLE Code: ${data.code}\nBatch: ${data.batch}
EXPERIMENT C13CPD
TITLE Code: ${data.code}\nBatch: ${data.batch}
        `;
        document.getElementById('iconnmr').innerHTML = experiment;
      }

      function save() {
        var blob = new Blob([document.getElementById('iconnmr').innerHTML], {
          type: 'text/plain;charset=utf-8'
        });
        saveAs(blob, `${data.user}_${data.code}_${data.batch}.txt`);
      }
    </script>
  </head>

  <body>
    <form id="theForm" onclick="changedForm(this)" onkeyup="changedForm(this)">
      Scan the sample:
      <input type="text" name="scan" onkeyup="split(this.value)" /><br />
      User: <input type="text" readonly name="user" id="user" /><br />
      Code: <input type="text" readonly name="code" id="code" /><br />
      Priority: <input type="checkbox" name="priority" /><br />
      Batch: <input type="text" readonly name="batch" id="batch" /><br />
      Holder: <input type="number" name="holder" /><br />
      Solvent:
      <select name="solvent">
        <option value="Acetic">acetic acid-d4</option>
        <option value="Actenon">acetone-d6</option>
        <option value="C6D6">benzene-d6</option>
        <option value="CD2Cl2">dichloromethane-d2</option>
        <option value="CDCl3">chloroform-d</option>
        <option value="D2O">deuteriumoxide</option>
        <option value="D2O_salt">deuteriumoxide with salt</option>
        <option value="Dioxane">dioxane-d8</option>
        <option value="DMF">N,N-dimethylformamide-d7</option>
        <option value="DMSO">dimethylsulfoxide-d6</option>
        <option value="EtOD">ethanol-d6</option>
        <option value="H2O+D2O">90%H2O and 10% D2O</option>
        <option value="H2O+D2O_salt">90%H2O and 10% D2O with salt</option>
        <option value="MeOD">methanol-d4</option>
        <option value="Pyr">pyridine-d5</option>
        <option value="TFE">trifluroethanol-d3</option>
        <option value="THF">terahydrofuran-d8</option>
        <option value="Tol">toluene-d8</option>
      </select>
    </form>
    <button onclick="save()">Start experiments</button><br />

    <textarea id="iconnmr" cols="60" rows="20"> </textarea>
  </body>
</html>
